!function(t){function e(r){if(i[r])return i[r].exports;var n=i[r]={i:r,l:!1,exports:{}};return t[r].call(n.exports,n,n.exports,e),n.l=!0,n.exports}var i={};e.m=t,e.c=i,e.d=function(t,i,r){e.o(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=19)}([function(t,e,i){"use strict";i.d(e,"a",function(){return o});var r=i(3),n=i(4),o=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.fromVector3=function(e){return new t(e.x,e.y)},t.prototype.set=function(e,i){if(e instanceof t||e instanceof n.b)this.x=e.x,this.y=e.y;else{if(void 0===i)throw new Error("Vector2.set(): 'x' is number, but no 'y' provided");this.x=e,this.y=i}return this},t.prototype.equalTo=function(t){return Object(r.c)(this.x,t.x)&&Object(r.c)(this.y,t.y)},t.prototype.toAngle=function(){return Math.atan2(this.y,this.x)*r.a.rad2deg},t.prototype.lengthQ=function(){return Math.pow(this.x,2)+Math.pow(this.y,2)},t.prototype.length=function(){return Math.sqrt(this.lengthQ())},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y)},t.prototype.addToSelf=function(e,i){if(e instanceof t||e instanceof n.b)this.x+=e.x,this.y+=e.y;else{if(void 0===i)throw new Error("Vector2.addToSelf(): 'x' is number but no 'y' provided");this.x+=e,this.y+=i}return this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y)},t.prototype.subtractFromSelf=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.multiplyNum=function(e){return new t(this.x*e,this.y*e)},t.prototype.multiplyNumSelf=function(t){return this.x*=t,this.y*=t,this},t.prototype.normal=function(){var e=this.length();return e<r.a.eps?new t(0,0):this.multiplyNum(1/e)},t.prototype.normalize=function(){var t=this.length();return t<r.a.eps?this.set(0,0):this.multiplyNumSelf(1/t),this},t.prototype.toString=function(){return"x: "+this.x+", y:"+this.y},t}()},function(t,e,i){"use strict";i.d(e,"b",function(){return r}),i.d(e,"c",function(){return n}),i.d(e,"a",function(){return o});var r,n,o=function(){function t(){}return t.registerWebGLContext=function(t){r=t},t.registerWebGLRenderer=function(t){n=t},t}()},function(t,e,i){"use strict";i.d(e,"g",function(){return r}),i.d(e,"f",function(){return n}),i.d(e,"i",function(){return o}),i.d(e,"e",function(){return s}),i.d(e,"h",function(){return a}),i.d(e,"a",function(){return h}),i.d(e,"c",function(){return u}),i.d(e,"d",function(){return c}),i.d(e,"b",function(){return p});var r;!function(t){t[t.Repeat=0]="Repeat",t[t.ClampToEdge=1]="ClampToEdge",t[t.MirrorRepeat=2]="MirrorRepeat"}(r||(r={}));var n;!function(t){t[t.Nearest=0]="Nearest",t[t.Linear=1]="Linear"}(n||(n={}));var o;!function(t){t[t.Pos2Tex2=0]="Pos2Tex2",t[t.Pos3Tex2=1]="Pos3Tex2",t[t.Pos3Tex2Nor3=2]="Pos3Tex2Nor3",t[t.Pos3Tex2Col4=3]="Pos3Tex2Col4"}(o||(o={}));var s;!function(t){t[t.Byte=0]="Byte",t[t.Short=1]="Short",t[t.Int=2]="Int"}(s||(s={}));var a;!function(t){t[t.vaCoord=0]="vaCoord",t[t.vaNormal=1]="vaNormal",t[t.vaTexCoord0=2]="vaTexCoord0",t[t.vaTexCoord1=3]="vaTexCoord1",t[t.vaColor=4]="vaColor"}(a||(a={}));var h;!function(t){t[t.None=0]="None",t[t.Alpha=1]="Alpha",t[t.Additive=2]="Additive",t[t.Multiply=3]="Multiply",t[t.Screen=4]="Screen"}(h||(h={}));var u;!function(t){t[t.None=0]="None",t[t.Back=1]="Back",t[t.Front=2]="Front"}(u||(u={}));var c;!function(t){t[t.Never=0]="Never",t[t.Less=1]="Less",t[t.Equal=2]="Equal",t[t.LessOrEqual=3]="LessOrEqual",t[t.Greater=4]="Greater",t[t.NotEqual=5]="NotEqual",t[t.GreaterOrEqual=6]="GreaterOrEqual",t[t.Always=7]="Always"}(c||(c={}));var p;!function(t){t[t.All=0]="All",t[t.Color=1]="Color",t[t.Depth=2]="Depth"}(p||(p={}))},function(t,e,i){"use strict";function r(t){return 0==(t&t-1)}function n(t,e){return Math.abs(t-e)<s.eps}function o(t,e,i){return Math.max(e,Math.min(i,t))}i.d(e,"a",function(){return s}),e.d=r,e.c=n,e.b=o;var s={pi:3.1415,deg2rad:3.1415/180,rad2deg:180/3.1415,eps:1e-5}},function(t,e,i){"use strict";i.d(e,"b",function(){return o}),i.d(e,"a",function(){return s});var r=i(3),n=i(0),o=function(){function t(t,e,i){this.x=t,this.y=e,this.z=i}return t.prototype.multiplyNum=function(e){return new t(this.x*e,this.y*e,this.z*e)},t.prototype.multiplyNumSelf=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.prototype.set=function(e,i,r){if(e instanceof n.a)this.x=e.x,this.y=e.y;else if(e instanceof t)this.x=e.x,this.y=e.y,this.z=e.z;else{if(void 0===i||void 0===r)throw new Error("Vector3.set(): 'x' is number but no 'y' and 'z' provided");this.x=e,this.y=i,this.z=r}return this},t.prototype.length=function(){return Math.sqrt(this.lengthQ())},t.prototype.lengthQ=function(){return Math.pow(this.x,2)+Math.pow(this.y,2)+Math.pow(this.z,2)},t.prototype.add=function(e){return new t(this.x+e.x,this.y+e.y,this.z+e.z)},t.prototype.addToSelf=function(e){return this.x+=e.x,this.y+=e.y,e instanceof t&&(this.z+=e.z),this},t.prototype.subtract=function(e){return new t(this.x-e.x,this.y-e.y,this.z-e.z)},t.prototype.normal=function(){var e=this.length();return e<r.a.eps?new t(0,0,0):this.multiplyNum(1/e)},t.prototype.normalize=function(){var t=this.length();return t<r.a.eps?this.set(0,0,0):this.multiplyNumSelf(1/t),this},t.prototype.lerp=function(t,e){return t.subtract(this).multiplyNum(e).add(this)},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},t.prototype.cross=function(e){return new t(this.y*e.z-this.z*e.y,this.z*e.x-this.x*e.z,this.x*e.y-this.y*e.x)},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},t.prototype.negateVector=function(){return new t(-this.x,-this.y,-this.z)},t}(),s=new o(0,0,1)},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var r=function(){function t(t,e,i,r){this.x=t,this.y=e,this.w=i,this.z=r}return t.prototype.set=function(t,e,i,r){this.x=t,this.y=e,this.z=r,this.w=i},t.prototype.asArray=function(){return[this.x,this.y,this.z,this.w]},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return u});var r=i(3),n=i(0),o=i(4),s=i(5),a=i(11),h=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),u=function(t){function e(e,i,r){var o=t.call(this)||this;return o.vertices=new Array(36),o._rotation=0,o._textureRegion=null,o._width=e||1,o._height=i||1,o._pivotPoint=r||new n.a(.5,.5),o.setDefaultVertices(),o.setDefaultTexCoords(),o.setVerticesColor(new s.a(1,1,1,1)),o}return h(e,t),e.getVerticesSize=function(){return 36},e.prototype.free=function(){t.prototype.free.call(this)},Object.defineProperty(e.prototype,"rotation",{get:function(){return this._rotation},set:function(t){Object(r.c)(this._rotation,t)||(this.matrix.identity(),this.matrix.rotate(t*r.a.deg2rad,o.a),this._rotation=t,this._rotation>360?this._rotation-=360:this._rotation<-360&&(this._rotation+=360))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"width",{get:function(){return this._width},set:function(t){Object(r.c)(this._width,t)||(this._width=t,this.setDefaultVertices())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this._height},set:function(t){Object(r.c)(this._height,t)||(this._height=t,this.setDefaultVertices())},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pivotPoint",{get:function(){return this._pivotPoint},set:function(t){this._pivotPoint.equalTo(t)||(this._pivotPoint.set(t.x,t.y),this.setDefaultVertices())},enumerable:!0,configurable:!0}),e.prototype.setDefaultVertices=function(){this.vertices[0]=(1-this.pivotPoint.x)*this._width,this.vertices[1]=(1-this.pivotPoint.y)*this._height,this.vertices[2]=0,this.vertices[9]=(1-this.pivotPoint.x)*this._width,this.vertices[10]=(0-this.pivotPoint.y)*this._height,this.vertices[11]=0,this.vertices[18]=(0-this.pivotPoint.x)*this._width,this.vertices[19]=(0-this.pivotPoint.y)*this._height,this.vertices[20]=0,this.vertices[27]=(0-this.pivotPoint.x)*this._width,this.vertices[28]=(1-this.pivotPoint.y)*this._height,this.vertices[29]=0},e.prototype.setDefaultTexCoords=function(){this.vertices[3]=1,this.vertices[4]=1,this.vertices[12]=1,this.vertices[13]=0,this.vertices[21]=0,this.vertices[22]=0,this.vertices[30]=0,this.vertices[31]=1},e.prototype.setFlippedTexCoords=function(){this.vertices[3]=1,this.vertices[4]=0,this.vertices[12]=1,this.vertices[13]=1,this.vertices[21]=0,this.vertices[22]=1,this.vertices[30]=0,this.vertices[31]=0},e.prototype.flipVerticallyCurrentTexCoords=function(){var t=0;t=this.vertices[30],this.vertices[30]=this.vertices[3],this.vertices[3]=t,t=this.vertices[12],this.vertices[12]=this.vertices[21],this.vertices[21]=t},e.prototype.flipHorizontallyCurrentTexCoords=function(){var t=0;t=this.vertices[4],this.vertices[4]=this.vertices[13],this.vertices[13]=t,t=this.vertices[22],this.vertices[22]=this.vertices[31],this.vertices[31]=t},e.prototype.setVerticesColor=function(t){for(var e=5;e<33;e+=9)this.vertices[e+0]=t.x,this.vertices[e+1]=t.y,this.vertices[e+2]=t.z,this.vertices[e+3]=t.w},e.prototype.setVerticesAlpha=function(t){this.vertices[8]=t,this.vertices[17]=t,this.vertices[26]=t,this.vertices[35]=t},e.prototype.setSize=function(t,e){Object(r.c)(this._width,t)&&Object(r.c)(this._height,e)||(this._width=t,this._height=e,this.setDefaultVertices())},e.prototype.setSizeFromVector2=function(t){this.setSize(t.x,t.y)},e.prototype.multSize=function(t){this.setSize(this._width*t,this._height*t)},e.prototype.setTextureRegion=function(t,e){void 0===e&&(e=!0),this._textureRegion=t,t.rotated?(this.vertices[3]=t.tx,this.vertices[4]=t.ty+t.th,this.vertices[12]=t.tx+t.tw,this.vertices[13]=t.ty+t.th,this.vertices[21]=t.tx+t.tw,this.vertices[22]=t.ty,this.vertices[30]=t.tx,this.vertices[31]=t.ty,e&&this.setSize(t.th*t.texture.height,t.tw*t.texture.width)):(this.vertices[3]=t.tx+t.tw,this.vertices[4]=t.ty+t.th,this.vertices[12]=t.tx+t.tw,this.vertices[13]=t.ty,this.vertices[21]=t.tx,this.vertices[22]=t.ty,this.vertices[30]=t.tx,this.vertices[31]=t.ty+t.th,e&&this.setSize(t.tw*t.texture.width,t.th*t.texture.height))},e.prototype.setTextureCoords=function(t){this.vertices[3]=t[0],this.vertices[4]=t[1],this.vertices[12]=t[2],this.vertices[13]=t[3],this.vertices[21]=t[4],this.vertices[22]=t[5],this.vertices[30]=t[6],this.vertices[31]=t[7]},e.prototype.getTextureRegion=function(){return this._textureRegion},e.prototype.getVerticesWithAbsoluteMatrix=function(){for(var t=this.absoluteMatrix,e=[new o.b(this.vertices[0],this.vertices[1],this.vertices[2]),new o.b(this.vertices[9],this.vertices[10],this.vertices[11]),new o.b(this.vertices[18],this.vertices[19],this.vertices[20]),new o.b(this.vertices[27],this.vertices[28],this.vertices[29])],i=0;i<e.length;++i)e[i]=t.multiplyVec(e[i]);var r=this.vertices.slice();return r[0]=e[0].x,r[1]=e[0].y,r[2]=e[0].z,r[9]=e[1].x,r[10]=e[1].y,r[11]=e[1].z,r[18]=e[2].x,r[19]=e[2].y,r[20]=e[2].z,r[27]=e[3].x,r[28]=e[3].y,r[29]=e[3].z,r},e.prototype.renderSelf=function(){},e}(a.a)},function(t,e,i){"use strict";i.d(e,"a",function(){return c});var r=i(9),n=i(10),o=i(1),s=i(2),a=i(6),h=[0,1,2,2,3,0],u=a.a.getVerticesSize(),c=function(){function t(){this._count=0,this._changed=!1,this._vertexData=new Array(65536),this._indexData=new Array(65536),this._vertexBuffer=new n.a(s.i.Pos3Tex2Col4,65536),this._indexBuffer=new r.a(s.e.Short,65536)}return t.prototype.free=function(){this._vertexBuffer.free(),this._indexBuffer.free()},t.prototype.start=function(){this._count=0},t.prototype.finish=function(){0!==this._count&&(this._changed&&(this._vertexBuffer.update(this._vertexData,0),this._indexBuffer.update(this._indexData,0)),o.c.renderParams.modelViewProjection=o.c.renderParams.viewProjection,o.c.drawTriangles(this._vertexBuffer,this._indexBuffer,0,6*this._count))},t.prototype.drawSingle=function(t){if(t.visible){for(var e=t.getVerticesWithAbsoluteMatrix(),i=0;i<u;++i)this._vertexData[this._count*u+i]=e[i];for(var i=0;i<6;++i)this._indexData[6*this._count+i]=h[i]+4*this._count;++this._count,this._changed=!0}},t.prototype.drawArray=function(t){var e=this;t.forEach(function(t){return e.drawSingle(t)})},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var r=i(3),n=i(4),o=function(){function t(){this.e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}return t.fromVectorAngle=function(e,i){var r=Math.sin(e),n=Math.cos(e),o=1-n,s=i.x*i.y,a=i.y*i.z,h=i.z*i.x,u=i.x*r,c=i.y*r,p=i.z*r,l=o*s,f=o*a,d=o*h,b=new t;return b.e=[o*i.x*i.x+n,l+p,d-c,0,l-p,o*i.y*i.y+n,f+u,0,d+c,f-u,o*i.z*i.z+n,0,0,0,0,1],b},t.prototype.multiplyMat=function(e){var i=new t,r=this,n=e;return i.e=[r.e[0]*n.e[0]+r.e[4]*n.e[1]+r.e[8]*n.e[2]+r.e[12]*n.e[3],r.e[1]*n.e[0]+r.e[5]*n.e[1]+r.e[9]*n.e[2]+r.e[13]*n.e[3],r.e[2]*n.e[0]+r.e[6]*n.e[1]+r.e[10]*n.e[2]+r.e[14]*n.e[3],r.e[3]*n.e[0]+r.e[7]*n.e[1]+r.e[11]*n.e[2]+r.e[15]*n.e[3],r.e[0]*n.e[4]+r.e[4]*n.e[5]+r.e[8]*n.e[6]+r.e[12]*n.e[7],r.e[1]*n.e[4]+r.e[5]*n.e[5]+r.e[9]*n.e[6]+r.e[13]*n.e[7],r.e[2]*n.e[4]+r.e[6]*n.e[5]+r.e[10]*n.e[6]+r.e[14]*n.e[7],r.e[3]*n.e[4]+r.e[7]*n.e[5]+r.e[11]*n.e[6]+r.e[15]*n.e[7],r.e[0]*n.e[8]+r.e[4]*n.e[9]+r.e[8]*n.e[10]+r.e[12]*n.e[11],r.e[1]*n.e[8]+r.e[5]*n.e[9]+r.e[9]*n.e[10]+r.e[13]*n.e[11],r.e[2]*n.e[8]+r.e[6]*n.e[9]+r.e[10]*n.e[10]+r.e[14]*n.e[11],r.e[3]*n.e[8]+r.e[7]*n.e[9]+r.e[11]*n.e[10]+r.e[15]*n.e[11],r.e[0]*n.e[12]+r.e[4]*n.e[13]+r.e[8]*n.e[14]+r.e[12]*n.e[15],r.e[1]*n.e[12]+r.e[5]*n.e[13]+r.e[9]*n.e[14]+r.e[13]*n.e[15],r.e[2]*n.e[12]+r.e[6]*n.e[13]+r.e[10]*n.e[14]+r.e[14]*n.e[15],r.e[3]*n.e[12]+r.e[7]*n.e[13]+r.e[11]*n.e[14]+r.e[15]*n.e[15]],i},t.prototype.multiplyMatSelf=function(t){return this.e=this.multiplyMat(t).e,this},t.prototype.multiplyVec=function(t){return new n.b(this.e[0]*t.x+this.e[4]*t.y+this.e[8]*t.z+this.e[12],this.e[1]*t.x+this.e[5]*t.y+this.e[9]*t.z+this.e[13],this.e[2]*t.x+this.e[6]*t.y+this.e[10]*t.z+this.e[14])},t.prototype.multiplyNum=function(e){for(var i=new t,r=0;r<16;++r)i.e[r]=this.e[r]*e;return i},t.prototype.identity=function(){this.e=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},t.prototype.ortho=function(t,e,i,r,n,o){this.e=[2/(e-t),0,0,0,0,2/(r-i),0,0,0,0,-2/(o-n),0,-(e+t)/(e-t),-(r+i)/(r-i),-(o+n)/(o-n),1]},t.prototype.perspective=function(t,e,i,n){t=Math.min(179.9,Math.max(0,t));var o=i*Math.tan(t*r.a.deg2rad*.5),s=o*e;this.frustum(-s,s,-o,o,i,n)},t.prototype.frustum=function(t,e,i,r,n,o){this.e=[2*n/(e-t),0,0,0,0,2*n/(r-i),0,0,(e+t)/(e-t),(r+i)/(r-i),(o+n)/(n-o),-1,0,0,2*o*n/(n-o),0]},t.prototype.transpose=function(){for(var e=new t,i=0;i<4;++i)for(var r=0;r<4;++r)e.e[4*i+r]=this.e[4*r+i];return e},t.prototype.rotate=function(e,i){var r=t.fromVectorAngle(e,i);this.multiplyMatSelf(r)},Object.defineProperty(t.prototype,"position",{get:function(){return new n.b(this.e[12],this.e[13],this.e[14])},set:function(t){this.e[12]=t.x,this.e[13]=t.y,this.e[14]=t.z},enumerable:!0,configurable:!0}),t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var r=i(1),n=i(2),o=function(){function t(e,i){if(this.format=e,this.count=i,this.buffer=r.b.createBuffer(),!this.buffer)return void console.log("Error while creating Index Buffer");this.bind(),r.b.bufferData(r.b.ELEMENT_ARRAY_BUFFER,i*t.getSizeFromFormat(e),r.b.STATIC_DRAW)}return t.getSizeFromFormat=function(t){switch(t){case n.e.Byte:return 1;case n.e.Short:return 2;case n.e.Int:return 4}},t.getWebGLFormat=function(t){switch(t){case n.e.Byte:return r.b.UNSIGNED_BYTE;case n.e.Short:return r.b.UNSIGNED_SHORT;case n.e.Int:return r.b.UNSIGNED_INT}},t.prototype.free=function(){r.b.deleteBuffer(this.buffer)},t.prototype.bind=function(){r.b.bindBuffer(r.b.ELEMENT_ARRAY_BUFFER,this.buffer)},t.prototype.update=function(t,e){this.bind();var i;switch(this.format){case n.e.Byte:i=new Uint8Array(t);break;case n.e.Short:i=new Uint16Array(t);break;case n.e.Int:i=new Uint32Array(t);break;default:return void console.log("IndexBuffer.update() - wrong format: "+this.format)}r.b.bufferSubData(r.b.ELEMENT_ARRAY_BUFFER,e,i)},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var r=i(1),n=i(2),o=function(){function t(t,e){if(this.format=t,this.count=e,this.buffer=r.b.createBuffer(),!this.buffer)return void console.log("Error while creating Vertex Buffer");this.bind();var i=e*this.getSizeFromFormat(this.format);r.b.bufferData(r.b.ARRAY_BUFFER,i,r.b.STATIC_DRAW)}return t.prototype.bind=function(){r.b.bindBuffer(r.b.ARRAY_BUFFER,this.buffer);var t=this.getSizeFromFormat(this.format);switch(this.format){case n.i.Pos3Tex2:r.b.enableVertexAttribArray(n.h.vaCoord),r.b.enableVertexAttribArray(n.h.vaTexCoord0),r.b.vertexAttribPointer(n.h.vaCoord,3,r.b.FLOAT,!1,t,0),r.b.vertexAttribPointer(n.h.vaTexCoord0,2,r.b.FLOAT,!1,t,12);break;case n.i.Pos2Tex2:r.b.enableVertexAttribArray(n.h.vaCoord),r.b.enableVertexAttribArray(n.h.vaTexCoord0),r.b.vertexAttribPointer(n.h.vaCoord,2,r.b.FLOAT,!1,t,0),r.b.vertexAttribPointer(n.h.vaTexCoord0,2,r.b.FLOAT,!1,t,8);break;case n.i.Pos3Tex2Nor3:r.b.enableVertexAttribArray(n.h.vaCoord),r.b.enableVertexAttribArray(n.h.vaTexCoord0),r.b.enableVertexAttribArray(n.h.vaNormal),r.b.vertexAttribPointer(n.h.vaCoord,3,r.b.FLOAT,!1,t,0),r.b.vertexAttribPointer(n.h.vaTexCoord0,2,r.b.FLOAT,!1,t,12),r.b.vertexAttribPointer(n.h.vaNormal,3,r.b.FLOAT,!1,t,20);break;case n.i.Pos3Tex2Col4:r.b.enableVertexAttribArray(n.h.vaCoord),r.b.enableVertexAttribArray(n.h.vaTexCoord0),r.b.enableVertexAttribArray(n.h.vaColor),r.b.vertexAttribPointer(n.h.vaCoord,3,r.b.FLOAT,!1,t,0),r.b.vertexAttribPointer(n.h.vaTexCoord0,2,r.b.FLOAT,!1,t,12),r.b.vertexAttribPointer(n.h.vaColor,4,r.b.FLOAT,!1,t,20)}},t.prototype.free=function(){r.b.deleteBuffer(this.buffer)},t.prototype.update=function(t,e){this.bind(),r.b.bufferSubData(r.b.ARRAY_BUFFER,e,new Float32Array(t))},t.prototype.getSizeFromFormat=function(t){switch(t){case n.i.Pos3Tex2:return 20;case n.i.Pos2Tex2:return 16;case n.i.Pos3Tex2Nor3:return 32;case n.i.Pos3Tex2Col4:return 36}},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(8),n=i(4),o=i(1),s=function(){function t(){this.matrix=new r.a,this.position=new n.b(0,0,0),this.visible=!0,this._dir=new n.b(0,0,0),this._right=new n.b(0,0,0),this._up=new n.b(0,0,0),this._parent=null,this._absoluteMatrix=new r.a,this.matrix.identity(),this.parent=null,this.updateVectorsFromMatrix()}return Object.defineProperty(t.prototype,"parent",{get:function(){return this._parent},set:function(t){this._parent!==t&&(this._parent=t)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"up",{get:function(){return this._up},set:function(t){if(t!==this._up){t.normalize();var e=t.cross(this._dir).negate().normalize(),i=e.cross(this._up).normalize();this.updateModelMatrix(i,t,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"direction",{get:function(){return this._dir},set:function(t){if(t!==this._dir){t.normalize();var e=this._up.cross(t).negate().normalize(),i=t.cross(e).normalize();this.updateModelMatrix(t,i,e)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){return this._right},set:function(t){if(t!==this._right){t.normalize();var e=t.cross(this._up).normalize(),i=e.cross(t).normalize();this.updateModelMatrix(e,i,t)}},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"absoluteMatrix",{get:function(){return this.matrix.position=this.position,this._absoluteMatrix=null===this._parent?this.matrix:this._parent.absoluteMatrix.multiplyMat(this.matrix),this._absoluteMatrix},set:function(t){this._absoluteMatrix=t},enumerable:!0,configurable:!0}),t.prototype.free=function(){},t.prototype.renderSelf=function(){o.c.renderParams.model=this.absoluteMatrix,o.c.renderParams.calculateMVP(),this.updateVectorsFromMatrix(),this.visible&&this.doRender()},t.prototype.updateModelMatrix=function(t,e,i){this.matrix.e=[i.x,e.x,t.x,0,i.y,e.y,t.y,0,i.z,e.z,t.z,0,this.position.dot(i),this.position.dot(e),this.position.dot(t)],this._dir=t,this._up=e,this._right=i},t.prototype.updateVectorsFromMatrix=function(){this._right.set(this.matrix.e[0],this.matrix.e[4],this.matrix.e[8]),this._up.set(this.matrix.e[1],this.matrix.e[5],this.matrix.e[9]),this._dir.set(this.matrix.e[2],this.matrix.e[6],this.matrix.e[10])},t.prototype.doRender=function(){},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var r;!function(t){t[t.TouchDown=0]="TouchDown",t[t.TouchUp=1]="TouchUp",t[t.TouchMove=2]="TouchMove",t[t.KeyDown=3]="KeyDown",t[t.KeyUp=4]="KeyUp",t[t.Wheel=5]="Wheel"}(r||(r={}))},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var r;!function(t){t[t.NoInput=0]="NoInput",t[t.LeftButton=1]="LeftButton",t[t.RightButton=2]="RightButton",t[t.Cancel=3]="Cancel",t[t.MiddleButton=4]="MiddleButton",t[t.XButton1=5]="XButton1",t[t.XButton2=6]="XButton2",t[t.Back=8]="Back",t[t.Tab=9]="Tab",t[t.Clear=12]="Clear",t[t.Return=13]="Return",t[t.Shift=16]="Shift",t[t.Ctrl=17]="Ctrl",t[t.Alt=18]="Alt",t[t.Pause=19]="Pause",t[t.CapsLock=20]="CapsLock",t[t.Escape=27]="Escape",t[t.Space=32]="Space",t[t.PageUp=33]="PageUp",t[t.PageDown=34]="PageDown",t[t.End=35]="End",t[t.Home=36]="Home",t[t.Left=37]="Left",t[t.Up=38]="Up",t[t.Right=39]="Right",t[t.Down=40]="Down",t[t.PrintScreen=44]="PrintScreen",t[t.Insert=45]="Insert",t[t.Delete=46]="Delete",t[t._0=48]="_0",t[t._1=49]="_1",t[t._2=50]="_2",t[t._3=51]="_3",t[t._4=52]="_4",t[t._5=53]="_5",t[t._6=54]="_6",t[t._7=55]="_7",t[t._8=56]="_8",t[t._9=57]="_9",t[t.A=65]="A",t[t.B=66]="B",t[t.C=67]="C",t[t.D=68]="D",t[t.E=69]="E",t[t.F=70]="F",t[t.G=71]="G",t[t.H=72]="H",t[t.I=73]="I",t[t.J=74]="J",t[t.K=75]="K",t[t.L=76]="L",t[t.M=77]="M",t[t.N=78]="N",t[t.O=79]="O",t[t.P=80]="P",t[t.Q=81]="Q",t[t.R=82]="R",t[t.S=83]="S",t[t.T=84]="T",t[t.U=85]="U",t[t.V=86]="V",t[t.W=87]="W",t[t.X=88]="X",t[t.Y=89]="Y",t[t.Z=90]="Z",t[t.LeftWin=91]="LeftWin",t[t.RightWin=92]="RightWin",t[t.Select=93]="Select",t[t.NumPad0=96]="NumPad0",t[t.NumPad1=97]="NumPad1",t[t.NumPad2=98]="NumPad2",t[t.NumPad3=99]="NumPad3",t[t.NumPad4=100]="NumPad4",t[t.NumPad5=101]="NumPad5",t[t.NumPad6=102]="NumPad6",t[t.NumPad7=103]="NumPad7",t[t.NumPad8=104]="NumPad8",t[t.NumPad9=105]="NumPad9",t[t.NumPadMul=106]="NumPadMul",t[t.NumPadAdd=107]="NumPadAdd",t[t.NumPadSeparator=108]="NumPadSeparator",t[t.NumPadSub=109]="NumPadSub",t[t.NumPadDecimal=110]="NumPadDecimal",t[t.NumPadDiv=111]="NumPadDiv",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.F13=124]="F13",t[t.F14=125]="F14",t[t.F15=126]="F15",t[t.F16=127]="F16",t[t.F17=128]="F17",t[t.F18=129]="F18",t[t.F19=130]="F19",t[t.F20=131]="F20",t[t.F21=132]="F21",t[t.F22=133]="F22",t[t.F23=134]="F23",t[t.F24=135]="F24",t[t.NumLock=144]="NumLock",t[t.ScrollLock=145]="ScrollLock",t[t.WheelUp=151]="WheelUp",t[t.WheelDown=152]="WheelDown",t[t.Semicolon=186]="Semicolon",t[t.Equal=187]="Equal",t[t.Comma=188]="Comma",t[t.Dash=189]="Dash",t[t.Period=190]="Period",t[t.ForwardSlash=191]="ForwardSlash",t[t.GraveAccent=192]="GraveAccent",t[t.OpenBracket=219]="OpenBracket",t[t.BackSlash=220]="BackSlash",t[t.CloseBracket=221]="CloseBracket",t[t.SingleQuote=222]="SingleQuote"}(r||(r={}))},function(t,e,i){"use strict";i.d(e,"b",function(){return r}),i.d(e,"c",function(){return s}),i.d(e,"a",function(){return h});var r,n=i(1),o=i(2);!function(t){t[t.Vertex=0]="Vertex",t[t.Fragment=1]="Fragment"}(r||(r={}));var s;!function(t){t[t.Vec1=0]="Vec1",t[t.Vec2=1]="Vec2",t[t.Vec3=2]="Vec3",t[t.Vec4=3]="Vec4",t[t.Mat4=4]="Mat4",t[t.Sampler=5]="Sampler",t[t.Int=6]="Int"}(s||(s={}));var a=function(){function t(t,e,i,r,n){this.type=t,this.name=e,this.count=i,this.index=r,this.data=n}return t}(),h=function(){function t(){if(this.shaders=[],this.uniforms=[],this.program=n.b.createProgram(),!this.program)return void console.error("ShaderProgram create failed")}return t.unbind=function(){n.b.useProgram(null)},t.prototype.free=function(){n.b.deleteProgram(this.program),this.shaders.forEach(function(t){n.b.deleteShader(t)})},t.prototype.bind=function(){n.b.useProgram(this.program);for(var t=0;t<this.uniforms.length;++t)this.uniforms[t].data&&this.setUniform(t)},t.prototype.attach=function(t,e){var i=this.getWebGLShaderType(t),s=n.b.createShader(i);if(!s)return void console.log("ShaderProgram.attach() failed - can't create shader with type "+i+" ("+t+")");if(this.shaders.push(s),n.b.shaderSource(s,e),n.b.compileShader(s),!n.b.getShaderParameter(s,n.b.COMPILE_STATUS)){console.log("ShaderProgram.attach() failed - can't compile "+t+" shader\n       InfoLog:");var a=n.b.getShaderInfoLog(s);return void console.log(a)}if(t===r.Vertex){var h=Object.keys(o.h).filter(function(t){return"number"==typeof o.h[t]});for(var u in h)n.b.bindAttribLocation(this.program,parseInt(u),o.h[u])}n.b.attachShader(this.program,s)},t.prototype.link=function(){var t=this;if(n.b.linkProgram(this.program),!n.b.getProgramParameter(this.program,n.b.LINK_STATUS)){console.log("ShaderProgram.link() failed at link\n        InfoLog:");var e=n.b.getProgramInfoLog(this.program);console.log(e)}if(n.b.validateProgram(this.program),!n.b.getProgramParameter(this.program,n.b.VALIDATE_STATUS)){console.log("ShaderProgram.link() failed at validate\n        InfoLog:");var e=n.b.getProgramInfoLog(this.program);console.log(e)}this.addUniform(s.Mat4,1,"uModelViewProj",n.c.renderParams.modelViewProjection.e),this.addUniform(s.Vec4,1,"uColor",n.c.renderParams.color.asArray()),this.shaders.forEach(function(e){return n.b.detachShader(t.program,e)})},t.prototype.addUniform=function(t,e,i,r){void 0===r&&(r=null);var o=n.b.getUniformLocation(this.program,i);if(!o)return console.log("ShaderProgram.addUniform failed - gl.getUniformLocation for "+i+" returned null (not found)"),null;var s=new a(t,i,e,o,r);return this.uniforms.push(s)},t.prototype.getUniformIndexByName=function(t){return this.uniforms.filter(function(e){return e.name===t})[0].index||null},t.prototype.setUniform=function(t,e){var i=this.uniforms[t];switch(e&&(i.data=e),i.type){case s.Vec1:n.b.uniform1fv(i.index,i.data);break;case s.Vec2:n.b.uniform2fv(i.index,i.data);break;case s.Vec3:n.b.uniform3fv(i.index,i.data);break;case s.Vec4:n.b.uniform4fv(i.index,i.data);break;case s.Mat4:n.b.uniformMatrix4fv(i.index,!1,i.data);break;case s.Sampler:case s.Int:n.b.uniform1iv(i.index,i.data)}},t.prototype.updateUniformValue=function(t,e){for(var i=-1,r=0;r<this.uniforms.length;++r)if(this.uniforms[r].name===t){i=r;break}if(-1===i)return void console.error("Uniform of name '"+t+"' was not found");this.uniforms[i].data=e},t.prototype.getWebGLShaderType=function(t){switch(t){case r.Vertex:return n.b.VERTEX_SHADER;case r.Fragment:return n.b.FRAGMENT_SHADER;default:return console.log("Unknown ShaderType: "+t+" at ShaderProgram.getWebGLShaderType()"),0}},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(3),n=i(1),o=i(2),s=function(){function t(){if(this.width=1,this.height=1,this.texture=n.b.createTexture(),null===this.texture)return void console.log("Texture create failed - null returned");n.b.bindTexture(n.b.TEXTURE_2D,this.texture);var t=new Uint8Array([0,0,255,255]);n.b.texImage2D(n.b.TEXTURE_2D,0,n.b.RGBA,1,1,0,n.b.RGBA,n.b.UNSIGNED_BYTE,t)}return t.unbind=function(){n.c.setTexture(null,0)},t.prototype.free=function(){n.b.deleteTexture(this.texture)},t.prototype.setWrap=function(t,e){n.b.bindTexture(n.b.TEXTURE_2D,this.texture),n.b.texParameteri(n.b.TEXTURE_2D,n.b.TEXTURE_WRAP_S,this.getWebGLWrap(t)),n.b.texParameteri(n.b.TEXTURE_2D,n.b.TEXTURE_WRAP_T,this.getWebGLWrap(e)),n.b.bindTexture(n.b.TEXTURE_2D,null)},t.prototype.setFilter=function(t){n.b.bindTexture(n.b.TEXTURE_2D,this.texture),n.b.texParameteri(n.b.TEXTURE_2D,n.b.TEXTURE_MIN_FILTER,this.getWebGLFilter(t)),n.b.texParameteri(n.b.TEXTURE_2D,n.b.TEXTURE_MAG_FILTER,this.getWebGLFilter(t)),n.b.bindTexture(n.b.TEXTURE_2D,null)},t.prototype.bind=function(t){void 0===t&&(t=0),n.c.setTexture(this,t)},t.prototype.loadFromImage=function(t){this.width=t.width,this.height=t.height,n.b.bindTexture(n.b.TEXTURE_2D,this.texture),n.b.texImage2D(n.b.TEXTURE_2D,0,n.b.RGBA,n.b.RGBA,n.b.UNSIGNED_BYTE,t),Object(r.d)(t.width)&&Object(r.d)(t.height)?n.b.generateMipmap(n.b.TEXTURE_2D):(n.b.texParameteri(n.b.TEXTURE_2D,n.b.TEXTURE_WRAP_S,n.b.CLAMP_TO_EDGE),n.b.texParameteri(n.b.TEXTURE_2D,n.b.TEXTURE_WRAP_T,n.b.CLAMP_TO_EDGE),n.b.texParameteri(n.b.TEXTURE_2D,n.b.TEXTURE_MIN_FILTER,n.b.LINEAR),n.b.texParameteri(n.b.TEXTURE_2D,n.b.TEXTURE_MAG_FILTER,n.b.LINEAR))},t.prototype.trySetAnisotropic=function(t){var e=n.b.getExtension("EXT_texture_filter_anisotropic")||n.b.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.b.getExtension("WEBKIT_EXT_texture_filter_anisotropic");if(e){var i=n.b.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT),r=Math.min(t,i);n.b.texParameterf(n.b.TEXTURE_2D,e.TEXTURE_MAX_ANISOTROPY_EXT,r)}},t.prototype.getWebGLWrap=function(t){switch(t){case o.g.Repeat:return n.b.REPEAT;case o.g.MirrorRepeat:return n.b.MIRRORED_REPEAT;default:case o.g.ClampToEdge:return n.b.CLAMP_TO_EDGE}},t.prototype.getWebGLFilter=function(t){switch(t){case o.f.Linear:return n.b.LINEAR;default:case o.f.Nearest:return n.b.NEAREST}},t}()},function(t,e,i){"use strict";i.d(e,"b",function(){return r}),i.d(e,"a",function(){return n});var r;!function(t){t[t.Wall=0]="Wall",t[t.Player=1]="Player",t[t.Health=2]="Health",t[t.Mana=3]="Mana"}(r||(r={}));var n=(function(){function t(){this.id="",this.region="",this.rotation=0,this.role=r.Wall}}(),function(){function t(){this.tileSize=0,this.tileTypes=[],this.map=""}}(),[{tileSize:64,tileTypes:[{id:"@",region:"",role:r.Player},{id:"h",region:"health1.png",role:r.Health},{id:"m",region:"mana1.png",role:r.Mana},{id:"1",region:"wall1.png"},{id:"2",region:"wall2.png"},{id:"3",region:"wall3.png"},{id:"4",region:"wall4.png"},{id:"5",region:"wall5.png"},{id:"6",region:"wall6.png"},{id:"7",region:"wall4.png",rotation:90},{id:"8",region:"wall4.png",rotation:-90},{id:"9",region:"wall4.png",rotation:180}],map:"445444464444644\n\n    h\n            h\n  111     111\n\n      @\n\n          m\n  111     111\n\n445443445444644\n"}])},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=function(){function t(){}return t}(),n=new r},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var r=i(3),n=i(0),o=function(){function t(t,e){this.center=t,this._closest=new n.a(0,0),this._distance=new n.a(0,0),this.raduisSquare=e*e}return t.prototype.overlaps=function(e){return e instanceof t?Math.abs(this.center.lengthQ()-e.center.lengthQ())<this.raduisSquare+e.raduisSquare:(this._closest.set(Object(r.b)(this.center.x,e.center.x-e.halfSize.x,e.center.x+e.halfSize.x),Object(r.b)(this.center.y,e.center.y-e.halfSize.y,e.center.y+e.halfSize.y)),this._distance.set(this.center.x-this._closest.x,this.center.y-this._closest.y),this._distance.lengthQ()<this.raduisSquare)},t}()},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=i(20),n=document.getElementById("canvas-main");if(n){new r.a(n).run()}},function(t,e,i){"use strict";i.d(e,"a",function(){return f});var r=i(7),n=i(21),o=i(22),s=i(28),a=i(16),h=i(17),u=i(40),c=i(42),p=i(43),l=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),f=function(t){function e(e){var i=t.call(this,e)||this;return i.canvasElement=e,i.spriteBatch=new r.a,i.spriteBatch2=new r.a,i.camera=new n.a,i.assets=new s.a,i.player=new c.a(i.input),i.level=new u.a,i.ready=!1,i}return l(e,t),e.prototype.onInit=function(){var t=this;this.player.body.position.set(this.renderer.width/2,this.renderer.height/2,1),this.player.weapon.position.set(24,0,-1),this.assets.loadAll().then(function(){t.player.weapon.setTextureRegion(t.assets.textureAtlas.getRegion("pistol2.png"),!0),t.player.weapon.multSize(2),t.level.material=t.assets.material,t.level.loadFromData(a.a[0]),t.player.body.position.set(t.level.playerStartPosition),t.bulletManager=new p.a(t.assets.textureAtlas.getRegion("bullet1.png")),h.a.currentLevel=t.level,h.a.bulletManager=t.bulletManager,t.ready=!0}),this.renderer.setClearColorRGB(.1,.2,.2,.5)},e.prototype.onUpdate=function(t){this.ready&&(this.player.onUpdate(t),this.bulletManager.update(t))},e.prototype.onRender=function(){t.prototype.onRender.call(this),this.ready&&(this.camera.update(),this.assets.shader.updateUniformValue("uModelViewProj",this.renderer.renderParams.modelViewProjection.e),this.assets.shader.updateUniformValue("uColor",this.renderer.renderParams.color.asArray()),this.level.draw(),this.assets.material.bind(),this.spriteBatch2.start(),this.spriteBatch2.drawSingle(this.player.weapon),this.spriteBatch2.finish(),this.bulletManager.draw(),this.assets.characterMaterial.bind(),this.spriteBatch.start(),this.spriteBatch.drawSingle(this.player.body),this.spriteBatch.finish())},e.prototype.onMouseMove=function(t){},e.prototype.onMouseDown=function(t){},e.prototype.onKeyDown=function(t){},e.prototype.onKeyUp=function(t){},e}(o.a)},function(t,e,i){"use strict";i.d(e,"a",function(){return p});var r,n=i(8),o=i(0),s=i(4),a=i(1),h=i(11),u=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}();!function(t){t[t.Ortho=0]="Ortho",t[t.Perspective=1]="Perspective"}(r||(r={}));var c;!function(t){t[t.TopLeft=0]="TopLeft",t[t.Center=1]="Center",t[t.BottomRight=2]="BottomRight"}(c||(c={}));var p=function(t){function e(){var e=t.call(this)||this;return e.projectionMatrix=new n.a,e._scale=1,e.setProjectionParamsFull(0,0,a.c.width,a.c.height,45,.01,100,r.Ortho,c.TopLeft),e.setViewParams(new s.b(0,0,100),new s.b(0,0,0),new s.b(0,1,0)),e}return u(e,t),Object.defineProperty(e.prototype,"scale",{get:function(){return this._scale},set:function(t){t!==this._scale&&(this._scale=t,this.rebuildProjectionMatrix())},enumerable:!0,configurable:!0}),e.prototype.setProjectionParams=function(t,e,i,r){i=i<0?1:i,r=r<0?1:r,this._x=t,this._y=e,this._width=i,this._height=r,this.rebuildProjectionMatrix()},e.prototype.setProjectionParamsFull=function(t,e,i,r,n,o,s,a,h){this._fov=n,this._zNear=o,this._zFar=s,this._projectionMode=a,this._pivotMode=h,this.setProjectionParams(t,e,i,r)},e.prototype.setViewParams=function(t,e,i){this.matrix.identity(),this._up=i.normal(),this._dir=e.subtract(t).normal(),this._right=this._dir.cross(this._up).normal(),this._up=this._right.cross(this._dir).normal(),this.position=t,this._dir.negate(),this.matrix.e=[this._right.x,this._right.y,this._right.z,this._right.negateVector().dot(this.position),this._up.x,this._up.y,this._up.z,this._up.negateVector().dot(this.position),this._dir.x,this._dir.y,this._dir.z,this._dir.negateVector().dot(this.position),0,0,0,1],this.matrix=this.matrix.transpose(),this.updateVectorsFromMatrix()},e.prototype.translate=function(t,e,i){var r=this._up.multiplyNum(t).add(this._right.multiplyNum(e)).add(this._dir.multiplyNum(i));this.position.addToSelf(r)},e.prototype.rotate=function(t,e){this.matrix.rotate(t,e),this.updateVectorsFromMatrix()},e.prototype.screenToWorld=function(t){if(this._projectionMode===r.Perspective)return console.error("Camera.ScreenToWorld() with perpective camera is not implemented"),new s.b(0,0,0);var e=o.a.fromVector3(this.position).addToSelf(t.multiplyNum(1/this._scale)),i=new o.a(0,0);switch(this._pivotMode){case c.Center:i.set(this._width/(2*this._scale),this._height/(2*this._scale));break;case c.BottomRight:i.set(this._width/this._scale,this._height/this._scale)}return e.subtractFromSelf(i),new s.b(e.x,e.y,0)},e.prototype.renderSelf=function(){},e.prototype.update=function(){this.matrix.position=new s.b(0,0,0),this.matrix.position=this.matrix.multiplyVec(this.position.negateVector()),a.c.renderParams.viewProjection=this.projectionMatrix.multiplyMat(this.matrix),a.c.renderParams.modelViewProjection=a.c.renderParams.viewProjection,this.updateVectorsFromMatrix(),a.c.width===this._width&&a.c.height===this._height||this.setProjectionParams(0,0,a.c.width,a.c.height)},e.prototype.rebuildProjectionMatrix=function(){switch(this.projectionMatrix.identity(),this._projectionMode){case r.Perspective:this.projectionMatrix.perspective(this._fov,this._width/this._height,this._zNear,this._zFar);break;case r.Ortho:var t=2*this._scale;switch(this._pivotMode){case c.TopLeft:this.projectionMatrix.ortho(0,this._width/this._scale,this._height/this._scale,0,this._zNear,this._zFar);break;case c.Center:this.projectionMatrix.ortho(-this._width/t,this._width/t,this._height/t,-this._height/t,this._zNear,this._zFar);break;case c.BottomRight:this.projectionMatrix.ortho(-this._width/t,0,0,-this._height/t,this._zNear,this._zFar)}}},e}(h.a)},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(23),n=i(25),o=i(2),s=function(){function t(t){var e=this;this.deltaTime=0,this.lastTime=0,this.currentTime=0,this.pauseAll=!1,this.input=new r.a,this.renderer=new n.a(t,this.input),this.renderer.onMouseMove=function(t){return e.onMouseMove(t)},this.renderer.onMouseDown=function(t){return e.onMouseDown(t)},this.renderer.setViewPort(0,0,t.width,t.height)}return t.prototype.run=function(){var t=this;this.onInit();var e=function(i){t.lastTime=t.currentTime,t.currentTime=i/1e3,t.deltaTime=Math.min(t.currentTime-t.lastTime,.1),t.pauseAll||(t.onUpdate(t.deltaTime),t.onRender()),window.requestAnimationFrame(e)};window.requestAnimationFrame(e)},t.prototype.onRender=function(){this.renderer.clear(o.b.All),this.renderer.resetStates(),this.renderer.resetStatistics()},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(0),n=i(12),o=i(24),s=function(){function t(){this.touches=[new o.a,new o.a,new o.a,new o.a,new o.a,new o.a,new o.a,new o.a,new o.a,new o.a],this.mousePos=new r.a(0,0),this.isKeyDown=new Array(256),this.lastWheelDelta=0}return t.prototype.process=function(t){var e=t.key;switch(t.inputType){case n.a.TouchDown:this.touches[e].isDown=!0,this.touches[e].start.set(t.x,t.y),this.touches[e].current.set(t.x,t.y);break;case n.a.TouchUp:this.touches[e].isDown=!1;break;case n.a.TouchMove:this.touches[e].current.set(t.x,t.y),this.mousePos.set(t.x,t.y);break;case n.a.KeyDown:this.isKeyDown[e]=!0;break;case n.a.KeyUp:this.isKeyDown[e]=!1;break;case n.a.Wheel:this.lastWheelDelta=t.w}},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(0),n=function(){function t(){this.isDown=!1,this.start=new r.a(0,0),this.current=new r.a(0,0)}return t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return f});var r=i(26),n=i(12),o=i(13),s=i(0),a=i(9),h=i(27),u=i(10),c=i(1),p=i(2),l=8,f=function(){function t(t,e){this.canvasElement=t,this.inputProcessor=e,this.renderParams=new h.a,this._blendingMode=p.a.None,this._depthWrite=!1,this._depthTest=!1,this._depthFunc=p.d.Never,this._textureSampler=new Array(l),this._statTextureBind=0,this._statTriCount=0,this._statDIPCount=0;var i=t.getContext("webgl")||t.getContext("experimental-webgl");if(!i)return void console.log("GL initialize failed");c.a.registerWebGLContext(i),c.a.registerWebGLRenderer(this),this.initWebGL(),this.createScreenQuad(),this.initEvents(),t.focus()}return Object.defineProperty(t.prototype,"textureBinds",{get:function(){return this._statTextureBind},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"triCount",{get:function(){return this._statTriCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"dipCount",{get:function(){return this._statDIPCount},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"width",{get:function(){return this._width},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"height",{get:function(){return this._height},enumerable:!0,configurable:!0}),t.prototype.free=function(){this._screenQuadVB.free(),this._screenQuadIB.free()},t.prototype.resize=function(t,e){this.setViewPort(0,0,t,e)},t.prototype.resetStates=function(){this.setCullMode(p.c.Back),this.setBlendingMode(p.a.Alpha),this.setDepthFunc(p.d.LessOrEqual),this.setDepthWrite(!0),this.setDepthTest(!0),this._activeSampler=-1;for(var t=0;t<l;++t)this._textureSampler[t]=null;this._shader=null,this._vertexBuffer=null,this._indexBuffer=null,this._frameBuffer=null,this.renderParams.color.set(1,1,1,1),this.renderParams.viewProjection.identity(),this.renderParams.model.identity()},t.prototype.resetStatistics=function(){this._statDIPCount=0,this._statTextureBind=0,this._statTriCount=0},t.prototype.clear=function(t){switch(t){case p.b.All:c.b.clear(c.b.COLOR_BUFFER_BIT|c.b.DEPTH_BUFFER_BIT);break;case p.b.Color:c.b.clear(c.b.COLOR_BUFFER_BIT);break;case p.b.Depth:c.b.clear(c.b.DEPTH_BUFFER_BIT)}},t.prototype.setClearColorRGB=function(t,e,i,r){c.b.clearColor(t,e,i,r)},t.prototype.setViewPort=function(t,e,i,r){this._width=i,this._height=r,c.b.viewport(t,e,i,r)},t.prototype.setCullMode=function(t){if(t!==this._cullMode){switch(t){case p.c.None:c.b.disable(c.b.CULL_FACE);break;case p.c.Front:c.b.cullFace(c.b.FRONT);break;case p.c.Back:c.b.cullFace(c.b.BACK)}this._cullMode===p.c.None&&c.b.enable(c.b.CULL_FACE),this._cullMode=t}},t.prototype.setBlendingMode=function(t){if(t!==this._blendingMode){switch(t){case p.a.None:c.b.disable(c.b.BLEND);break;case p.a.Alpha:c.b.blendFunc(c.b.SRC_ALPHA,c.b.ONE_MINUS_SRC_ALPHA);break;case p.a.Additive:c.b.blendFunc(c.b.ONE,c.b.ONE);break;case p.a.Multiply:c.b.blendFunc(c.b.DST_COLOR,c.b.ZERO);break;case p.a.Screen:c.b.blendFunc(c.b.ONE,c.b.ONE_MINUS_SRC_COLOR)}this._blendingMode===p.a.None&&c.b.enable(c.b.BLEND),this._blendingMode=t}},t.prototype.setDepthWrite=function(t){t!==this._depthWrite&&(c.b.depthMask(t),this._depthWrite=t)},t.prototype.setDepthTest=function(t){t!==this._depthTest&&(t?c.b.enable(c.b.DEPTH_TEST):c.b.disable(c.b.DEPTH_TEST),this._depthTest=t)},t.prototype.setDepthFunc=function(t){t!==this._depthFunc&&(c.b.depthFunc(this.getWebGLComparison(t)),this._depthFunc=t)},t.prototype.setShader=function(t){t!==this._shader&&(c.b.useProgram(t.program),this._shader=t)},t.prototype.setTexture=function(t,e){this._textureSampler[e]!==t&&(this._activeSampler!==e&&(c.b.activeTexture(c.b.TEXTURE0+e),this._activeSampler=e),c.b.bindTexture(c.b.TEXTURE_2D,null===t?null:t.texture),this._textureSampler[e]=t,++this._statTextureBind)},t.prototype.setVertexBuffer=function(t){if(!t)return void c.b.bindBuffer(c.b.ARRAY_BUFFER,null);t!==this._vertexBuffer&&(t.bind(),this._vertexBuffer=t)},t.prototype.setIndexBuffer=function(t){if(!t)return void c.b.bindBuffer(c.b.ELEMENT_ARRAY_BUFFER,null);t!==this._indexBuffer&&(t.bind(),this._indexBuffer=t)},t.prototype.drawTriangles=function(t,e,i,r){this.setVertexBuffer(t),this.setIndexBuffer(e),c.b.drawElements(c.b.TRIANGLES,r,a.a.getWebGLFormat(e.format),i*a.a.getSizeFromFormat(e.format)),++this._statDIPCount,this._statTriCount+=Math.floor(r/3)},t.prototype.drawScreenQuad=function(t){this.renderParams.viewProjection.ortho(0,1,1,0,-1,1),this.renderParams.modelViewProjection=this.renderParams.viewProjection,t.bind(),this.clear(p.b.All),this.drawTriangles(this._screenQuadVB,this._screenQuadIB,0,6)},t.prototype.initWebGL=function(){var t="\n      Graphics information:\n      Vendor: "+c.b.getParameter(c.b.VENDOR)+"\n      Renderer: "+c.b.getParameter(c.b.RENDERER)+"\n      OpenGL: "+c.b.getParameter(c.b.VERSION)+"\n      GLSL: "+c.b.getParameter(c.b.SHADING_LANGUAGE_VERSION)+"\n      ";console.log(t),c.b.viewport(0,0,this.canvasElement.width,this.canvasElement.height)},t.prototype.initEvents=function(){var t=this,e=new s.a(this.canvasElement.getBoundingClientRect().left,this.canvasElement.getBoundingClientRect().top);new s.a(this.canvasElement.width,this.canvasElement.height);this.canvasElement.onmousemove=function(i){var r=t.getInputEventFromMouseEvent(i);t.inputProcessor.process(r),t.onMouseMove&&t.onMouseMove(new s.a(i.pageX-e.x,i.pageY-e.y))},this.canvasElement.onmousedown=function(i){var r=t.getInputEventFromMouseEvent(i);t.inputProcessor.process(r),t.onMouseDown&&t.onMouseDown(new s.a(i.pageX-e.x,i.pageY-e.y))},this.canvasElement.onwheel=function(e){e.preventDefault();var i=t.getInputEventFromMouseEvent(e);t.inputProcessor.process(i)},this.canvasElement.onkeydown=function(e){e.preventDefault();var i=t.getInputEventFromKeyEvent(e);t.inputProcessor.process(i)},this.canvasElement.onkeyup=function(e){e.preventDefault();var i=t.getInputEventFromKeyEvent(e);t.inputProcessor.process(i)}},t.prototype.createScreenQuad=function(){var t=[1,1,1,1,0,1,1,1,1,1,0,1,1,1,1,1,1,1,0,0,1,0,1,1,1,1,1,0,1,1,0,0,1,1,1,1],e=[0,1,2,2,3,0];this._screenQuadVB=new u.a(p.i.Pos3Tex2Col4,4),this._screenQuadIB=new a.a(p.e.Byte,6),this._screenQuadVB.update(t,0),this._screenQuadIB.update(e,0)},t.prototype.getWebGLComparison=function(t){switch(t){case p.d.Never:return c.b.NEVER;case p.d.Less:return c.b.LESS;case p.d.Equal:return c.b.EQUAL;case p.d.LessOrEqual:return c.b.LEQUAL;case p.d.Greater:return c.b.GREATER;case p.d.NotEqual:return c.b.NOTEQUAL;case p.d.GreaterOrEqual:return c.b.GEQUAL;case p.d.Always:return c.b.ALWAYS}},t.prototype.getInputEventFromMouseEvent=function(t){var e;switch(t.button){case 0:e=o.a.LeftButton;break;case 1:e=o.a.MiddleButton;break;case 2:e=o.a.RightButton;break;default:e=o.a.NoInput}var i=t.pageX-this.canvasElement.getBoundingClientRect().left,s=t.pageY-this.canvasElement.getBoundingClientRect().top,a=n.a.TouchMove,h=0;switch(t.type){case"mousedown":a=n.a.TouchDown;break;case"mouseup":a=n.a.TouchUp;break;case"mousemove":a=n.a.TouchMove;break;case"wheel":a=n.a.Wheel,h=t.deltaY}return new r.a(a,e,i,s,h)},t.prototype.getInputEventFromKeyEvent=function(t){var e=n.a.TouchMove;switch(t.type){case"keydown":e=n.a.KeyDown;break;case"keyup":e=n.a.KeyUp}var i=t.keyCode;return new r.a(e,i,0,0,0)},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var r=function(){function t(t,e,i,r,n){this.inputType=t,this.key=e,this.x=i,this.y=r,this.w=n,this._initialized=!1,this._initialized=!0}return t.prototype.reset=function(t,e,i,r,n){this.inputType=t,this.key=e,this.x=i,this.y=r,this.w=n,this._initialized=!0},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var r=i(8),n=i(5),o=function(){function t(){this.viewProjection=new r.a,this.model=new r.a,this.modelViewProjection=new r.a,this.color=new n.a(1,1,1,1),this.calculateMVP()}return t.prototype.calculateMVP=function(){this.modelViewProjection=this.viewProjection.multiplyMat(this.model)},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var r=i(29),n=i(37),o=i(38),s=i(39),a=function(){function t(){}return t.prototype.loadAll=function(){var t=this;return new Promise(function(e,i){var a=new r.a;Promise.all([a.loadShaderProgram(o.a),a.loadTextureAtlas(s.b),a.loadTexture(s.a)]).then(function(e){return t.shader=e[0],t.textureAtlas=e[1],t.characterTexture=e[2],e}).then(function(){return n.a.shaderProgram=t.shader,n.a.textures[0].textureAtlas=t.textureAtlas,a.loadMaterial(n.a)}).then(function(e){return t.material=e}).then(function(){return n.a.textures[0].textureAtlas=void 0,n.a.textures[0].texture=t.characterTexture,a.loadMaterial(n.a)}).then(function(e){return t.characterMaterial=e}).then(function(){return e()})})},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var r=i(30),n=i(32),o=i(33),s=i(36),a=function(){function t(){this._textureLoader=new s.a,this._textureAtlasLoader=new o.a,this._shaderLoader=new n.a,this._materialLoader=new r.a}return t.prototype.loadTexture=function(t){return this._textureLoader.load(t)},t.prototype.loadTextureAtlas=function(t){return this._textureAtlasLoader.load(t)},t.prototype.loadShaderProgram=function(t){return this._shaderLoader.load(t)},t.prototype.loadMaterial=function(t){return this._materialLoader.load(t,this._shaderLoader,this._textureLoader,this._textureAtlasLoader)},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(31),n=function(){function t(){}return t.prototype.load=function(t,e,i,n){return new Promise(function(o,s){if(!t.shaderProgram&&!t.shaderProgramData)throw new Error("Can't create material - no shader or shader data provided");var a=new r.a;a.blend=t.blend,a.color=t.color,a.cull=t.cull,a.depthTest=t.depthTest,a.depthTestFunc=t.depthTestFunc,a.depthWrite=t.depthWrite,(t.shaderProgram?new Promise(function(e,i){return e(t.shaderProgram)}):e.load(t.shaderProgramData)).then(function(t){return a.shader=t}).then(function(){for(var e=[],r=0,s=t.textures;r<s.length;r++){var h=s[r];!function(t){if(t.texture)a.addTexture(t.texture,t.uniformName);else if(t.textureAtlas)a.addTexture(t.textureAtlas,t.uniformName);else if(t.textureData){var r=i.load(t.textureData).then(function(e){return a.addTexture(e,t.uniformName)});e.push(r)}else{if(!t.textureAtlasData)throw new Error("Can't add texture with uniformName '"+t.uniformName+"'\n                 to material - no texture or texture data provided");var r=n.load(t.textureAtlasData).then(function(e){return a.addTexture(e,t.uniformName)});e.push(r)}}(h)}Promise.all(e).then(function(){return o(a)})})})},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return h});var r=i(5),n=i(14),o=i(1),s=i(2),a=function(){function t(t,e,i){this.texture=t,this.uniformName=e,this.shaderInternalIndex=i}return t}(),h=function(){function t(){this.textures=[],this.color=new r.a(1,1,1,1),this.blend=s.a.Alpha,this.depthWrite=!0,this.depthTest=!0,this.depthTestFunc=s.d.Less,this.cull=s.c.Back}return t.prototype.free=function(){},t.prototype.addTexture=function(t,e){if(!this.shader)return void console.error("Material.addTexture() failed - no shader at material");var i=this.shader.addUniform(n.c.Sampler,1,e,this.textures.length);if(null===i)return void console.error("Material.addTexture() failed - can't determine shader index for '"+e+"'");this.textures.push(new a(t,e,i))},t.prototype.bind=function(){o.c.setBlendingMode(this.blend),o.c.setCullMode(this.cull),o.c.setDepthWrite(this.depthWrite),o.c.setDepthTest(this.depthTest),o.c.setDepthFunc(this.depthTestFunc),o.c.renderParams.color=this.color,this.textures.forEach(function(t,e){t.texture.bind(e)}),this.shader&&this.shader.bind()},t.prototype.unbind=function(){n.a.unbind()},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(14),n=function(){function t(){}return t.prototype.load=function(t){return new Promise(function(e,i){var n=new r.a;n.attach(r.b.Vertex,t.vertexShaderText),n.attach(r.b.Fragment,t.fragmentShaderText),n.link(),e(n)})},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var r=i(34),n=i(35),o=function(){function t(){}return t.prototype.load=function(t){return new Promise(function(e,i){var o=new n.a,s=new Image;s.onload=function(n){o.loadFromImage(s),o.setFilter(t.filter),t.anisotropic>0&&o.trySetAnisotropic(t.anisotropic),console.log("Texture '"+t.imageFileSrc+"' loaded, width: "+s.width+", height: "+s.height),r.a.getTextFromUrl(t.atlasFileSrc).then(function(t){o.loadRegionInfo(t),e(o)}).catch(function(t){return i(t)})},s.onerror=function(t){return i(t)},s.src=t.imageFileSrc})},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var r=function(){function t(){}return t.getElementDataOrEmpty=function(t){var e=document.getElementById(t);return e?e.innerHTML:""},t.getTextFromUrl=function(t){return new Promise(function(e,i){var r=new XMLHttpRequest;r.open("get",t),r.onload=function(){r.status>=200&&r.status<300?e(r.response):i({status:r.status,statusText:r.statusText})},r.onerror=function(){i({status:r.status,statusText:r.statusText})},r.send()})},t.getJSONFromUrl=function(t){return this.getTextFromUrl(t).then(function(t){return JSON.parse(t)})},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(15),n=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])};return function(e,i){function r(){this.constructor=e}t(e,i),e.prototype=null===i?Object.create(i):(r.prototype=i.prototype,new r)}}(),o=(function(){function t(){}}(),/(.*?)\t(\d*?)\t(\d*?)\t(\d*?)\t(\d*?)\t(\d*?)\t(\d*?)\t(\d*?)\t(\d*?)\t([r]?)/),s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._regions=[],e}return n(e,t),e.prototype.free=function(){t.prototype.free.call(this)},e.prototype.getRegion=function(t){var e=this._regions.filter(function(e){return e.name===t});return 0===e.length?console.error("Can't find region '"+t+"'"):e.length>1&&console.error("Too many regions ("+e.length+") with name '"+t+"'"),e[0]},e.prototype.loadRegionInfo=function(t){for(var e=t.split("\n").slice(1),i=0,r=e;i<r.length;i++){var n=r[i];if(n&&0!==n.length){var s=o.exec(n);s?this._regions.push({texture:this,name:s[1],tx:parseInt(s[2])/this.width,ty:parseInt(s[3])/this.height,tw:parseInt(s[4])/this.width,th:parseInt(s[5])/this.height,rotated:s.length>10&&"r"===s[10]}):console.error("TextureAtlas - can't parse line '"+n+"'")}}},e}(r.a)},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(15),n=function(){function t(){}return t.prototype.load=function(t){return new Promise(function(e,i){var n=new r.a,o=new Image;o.onload=function(i){n.loadFromImage(o),n.setFilter(t.filter),t.anisotropic>0&&n.trySetAnisotropic(t.anisotropic),console.log("Texture '"+t.imageFileSrc+"' loaded, width: "+o.width+", height: "+o.height),e(n)},o.onerror=function(t){return i(t)},o.src=t.imageFileSrc})},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return o});var r=i(5),n=i(2),o={textures:[{uniformName:"uDiffuse"}],color:new r.a(1,1,1,1),blend:n.a.Alpha,depthWrite:!0,depthTest:!0,depthTestFunc:n.d.Less,cull:n.c.Back}},function(t,e,i){"use strict";i.d(e,"a",function(){return r});var r={vertexShaderText:"\n  attribute vec3 vaCoord;\n  attribute vec2 vaTexCoord0;\n  attribute vec4 vaColor;\n  varying vec2 texCoord0;\n  varying vec4 vColor;\n  uniform mat4 uModelViewProj;\n\n  void main(void)\n  {\n    texCoord0 = vaTexCoord0;\n    vColor = vaColor;\n    gl_Position = uModelViewProj * vec4(vaCoord, 1.0);\n  }\n  ",fragmentShaderText:"\n  varying highp vec2 texCoord0;\n  varying highp vec4 vColor;\n  uniform sampler2D uDiffuse;\n  uniform highp vec4 uColor;\n\n  void main(void)\n  {\n    gl_FragColor = uColor * vColor * texture2D( uDiffuse, texCoord0 );\n    if (gl_FragColor.a < 0.001)\n      discard;\n  }\n  "}},function(t,e,i){"use strict";i.d(e,"b",function(){return n}),i.d(e,"a",function(){return o});var r=i(2),n={imageFileSrc:"assets/atlas.png",atlasFileSrc:"assets/atlas.atlas",filter:r.f.Nearest,anisotropic:0},o={imageFileSrc:"assets/character.png",filter:r.f.Nearest,anisotropic:0}},function(t,e,i){"use strict";i.d(e,"a",function(){return u});var r=i(0),n=i(5),o=i(7),s=i(6),a=i(16),h=i(41),u=function(){function t(){this.sprites=new Array(300),this.colliders=new Array(300),this.backgroundColor=new n.a(.1,.2,.2,.5),this.playerStartPosition=new r.a(0,0),this._spriteBatch=new o.a}return t.prototype.loadFromData=function(t){for(var e=t.map.split("\n"),i=new r.a(.5,.5),n=this.material.textures[0].texture,o=0;o<e.length;++o){var u=e[o];if(0!==u.length)for(var c=this,p=0;p<u.length;++p)!function(e){var p=u[e];if(" "===p)return"continue";var l=t.tileTypes.filter(function(t){return t.id===p});if(1!==l.length)throw new Error("Error while determine region for tile '"+u[e]+"' - found "+l.length+" results");if(l[0].role===a.b.Player)return c.playerStartPosition.set(e*t.tileSize,o*t.tileSize),"continue";var f=n.getRegion(l[0].region),d=new s.a(1,1,i);d.position.set(t.tileSize/2+e*t.tileSize,t.tileSize/2+o*t.tileSize,.5),d.setTextureRegion(f,!0),d.multSize(2),l[0].rotation&&(d.rotation=l[0].rotation),c.sprites.push(d),c.colliders.push(new h.a(new r.a(d.position.x,d.position.y),new r.a(d.width,d.height)))}(p)}this.staticDraw()},t.prototype.draw=function(){this.material.bind(),this._spriteBatch.finish()},t.prototype.collide=function(t){return this.colliders.some(function(e){return e.overlaps(t)})},t.prototype.staticDraw=function(){this._spriteBatch.start(),this._spriteBatch.drawArray(this.sprites)},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=i(0),n=function(){function t(t,e){this.center=t,this.halfSize=new r.a(e.x/2,e.y/2)}return t.prototype.overlaps=function(e){return e instanceof t?!(Math.abs(this.center.x-e.center.x)>this.halfSize.x+e.halfSize.x)&&!(Math.abs(this.center.y-e.center.y)>this.halfSize.y+e.halfSize.y):e.overlaps(this)},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return f});var r=i(13),n=i(3),o=i(0),s=i(6),a=i(17),h=i(18),u=[96,128],c=32,p=150,l=3,f=function(){function t(t){this.input=t,this.speed=p,this.body=new s.a(2*c,2*c),this.weapon=new s.a,this.collider=new h.a(new o.a(this.body.position.x,this.body.position.y),this.body.width/2-l),this.nextCollider=new h.a(new o.a(this.body.position.x,this.body.position.y),this.body.width/2-l),this.currentAnimationYCoord=0,this.currentAnimationXCoord=0,this.moveVector=new o.a(0,0),this.weaponPosition=new o.a(0,0),this.animationTimer=0,this.flippedX=!1,this.weaponUpCorrection=0,this.weaponZ=1,this.nextPosition=new o.a(0,1),this.weaponShotTimer=0,this.weaponAbsolutePosition=new o.a,this.characterDirection=new o.a,this.setAnimation(),this.weapon.parent=this.body}return t.prototype.onUpdate=function(t){this.moveVector.set(0,0),this.input.isKeyDown[r.a.Down]||this.input.isKeyDown[r.a.S]?(this.currentAnimationYCoord=0*c,this.moveVector.y=1,this.weaponUpCorrection=6,this.weaponZ=1):(this.input.isKeyDown[r.a.Up]||this.input.isKeyDown[r.a.W])&&(this.currentAnimationYCoord=3*c,this.moveVector.y=-1,this.weaponUpCorrection=12,this.weaponZ=-.5),this.input.isKeyDown[r.a.Left]||this.input.isKeyDown[r.a.A]?(this.currentAnimationYCoord=1*c,this.moveVector.x=-1,this.flippedX||(this.flippedX=!0,this.weapon.flipVerticallyCurrentTexCoords()),this.weaponPosition.x=-32):(this.input.isKeyDown[r.a.Right]||this.input.isKeyDown[r.a.D])&&(this.currentAnimationYCoord=2*c,this.moveVector.x=1,this.flippedX&&(this.flippedX=!1,this.weapon.flipVerticallyCurrentTexCoords()),this.weaponPosition.x=32),this.moveVector.normalize(),this.input.isKeyDown[r.a.Space]&&this.weaponShotTimer<=0&&(a.a.bulletManager.fire(this.weaponAbsolutePosition,this.characterDirection),this.weaponShotTimer=.4),this.moveVector.lengthQ()>n.a.eps&&(this.characterDirection.set(this.moveVector),this.setAnimation(),this.weapon.rotation=this.moveVector.toAngle()+90,this.weaponPosition.set(32*this.moveVector.x,this.weaponUpCorrection+32*this.moveVector.y),this.weapon.position.set(this.weaponPosition.x,this.weaponPosition.y,this.weaponZ),this.weaponAbsolutePosition.set(this.weaponPosition.x+this.body.position.x,this.weaponPosition.y+this.body.position.y),this.moveVector.multiplyNumSelf(this.speed*t),this.calculateMoveVector(),this.body.position.addToSelf(this.moveVector),this.collider.center.set(this.body.position.x,this.body.position.y),this.animationTimer+=t,this.animationTimer>.1&&(this.animationTimer=0,this.currentAnimationXCoord=(this.currentAnimationXCoord+c)%u[0])),this.weaponShotTimer>0&&(this.weaponShotTimer-=t)},t.prototype.setAnimation=function(){this.body.setTextureCoords([(this.currentAnimationXCoord+c)/u[0],(this.currentAnimationYCoord+c)/u[1],(this.currentAnimationXCoord+c)/u[0],this.currentAnimationYCoord/u[1],this.currentAnimationXCoord/u[0],this.currentAnimationYCoord/u[1],this.currentAnimationXCoord/u[0],(this.currentAnimationYCoord+c)/u[1]])},t.prototype.calculateMoveVector=function(){if(this.nextPosition.set(this.body.position).addToSelf(this.moveVector),this.nextCollider.center.set(this.nextPosition),a.a.currentLevel.collide(this.nextCollider)){if(this.nextPosition.set(this.body.position).addToSelf(this.moveVector.x,0),this.nextCollider.center.set(this.nextPosition),!a.a.currentLevel.collide(this.nextCollider))return void(this.moveVector.y=0);if(this.nextPosition.set(this.body.position).addToSelf(0,this.moveVector.y),this.nextCollider.center.set(this.nextPosition),!a.a.currentLevel.collide(this.nextCollider))return void(this.moveVector.x=0);this.moveVector.set(0,0)}},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i(7),n=i(44),o=i(45),s=function(){function t(t){var e=this;this.bulletTextureRegion=t,this.spriteBatch=new r.a,this.bulletsPool=new o.a(function(){return e.createBullet()},50)}return t.prototype.update=function(t){for(var e=0,i=this.bulletsPool.poolObjects;e<i.length;e++){i[e].update(t)}},t.prototype.fire=function(t,e){var i=this.bulletsPool.get();i.sprite.position.set(t),i.moveVector.set(e),i.sprite.rotation=e.toAngle()},t.prototype.draw=function(){this.spriteBatch.start();for(var t=0,e=this.bulletsPool.poolObjects;t<e.length;t++){var i=e[t];this.spriteBatch.drawSingle(i.sprite)}this.spriteBatch.finish()},t.prototype.createBullet=function(){return new n.a(this.bulletTextureRegion,1)},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return a});var r=i(0),n=i(1),o=i(6),s=i(18),a=function(){function t(t,e){void 0===e&&(e=1),this.active=!1,this.moveVector=new r.a,this.moveVectorN=new r.a,this.sprite=new o.a,this.sprite.position.z=1,this.sprite.setTextureRegion(t,!0),this.sprite.multSize(e),this.collider=new s.a(new r.a,this.sprite.width/2)}return t.prototype.onActivate=function(){this.sprite.visible=!0},t.prototype.onDeactivate=function(){this.sprite.visible=!1},t.prototype.update=function(t){this.active&&(this.moveVectorN=this.moveVector.multiplyNum(550*t),this.sprite.position.addToSelf(this.moveVectorN),this.collider.center.set(this.sprite.position),this.isOutOfScreen()&&(this.active=!1,this.onDeactivate()))},t.prototype.isOutOfScreen=function(){return this.sprite.position.x<0||this.sprite.position.x>n.c.width||this.sprite.position.y<0||this.sprite.position.y>n.c.height},t}()},function(t,e,i){"use strict";i.d(e,"a",function(){return n});var r=30,n=function(){function t(t,e){this.newItem=t,this.poolObjects=new Array(e||r);for(var i=0;i<this.poolObjects.length;++i)this.poolObjects[i]=this.newItem(),this.poolObjects[i].onDeactivate()}return t.prototype.get=function(){for(var t=0,e=this.poolObjects;t<e.length;t++){var i=e[t];if(!i.active)return i.active=!0,i.onActivate(),i}var r=this.newItem();return r.active=!0,r.onActivate(),this.poolObjects.push(r),r},t.prototype.return=function(t){t.active=!1,t.onDeactivate()},t}()}]);